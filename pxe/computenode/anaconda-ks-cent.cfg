# Kickstart file automatically generated by anaconda.
#compute node
#version=DEVEL
install
cdrom
lang en_US.UTF-8
keyboard us
reboot

#Mgmtnet
network  --activate --onboot yes --device eth0 --bootproto static --noipv6
network  --activate --onboot yes --device eth1 --bootproto static --noipv6
network  --activate --onboot yes --device bond0 --bootproto dhcp --bondopts=mode=active-backup,miimon=100,primary=eth0 --noipv6 --bondslaves eth0,eth1

#Datanet
network --activate --onboot yes --device eth2 --bootproto static --noipv6
network --activate --onboot yes --device eth3 --bootproto static --noipv6
network --activate --onboot yes --device bond1 --bootproto dhcp --bondopts=mode=balance-alb,miimon=100,primary=eth2 --noipv6 --bondslaves eth2,eth3


rootpw  --iscrypted $6$2Hd0d.j2Pud2GDqW$JMBdYd3Jxt51LsiBOW6ZGuTZpk.I.dZyy20jlCenybz5a748/ZUzHuixaO3rfqsq1ZS4ASS/hbKqDBGVJKcGF0
firewall --disabled
authconfig --enableshadow --passalgo=sha512
#selinux --disabled
selinux --permissive
timezone --utc America/New_York
group --name transystem
user --name=transuser --groups=transystem --homedir=/home/transuser --password $6$2Hd0d.j2Pud2GDqW$JMBdYd3Jxt51LsiBOW6ZGuTZpk.I.dZyy20jlCenybz5a748/ZUzHuixaO3rfqsq1ZS4ASS/hbKqDBGVJKcGF0 --iscrypted

bootloader --location=mbr --driveorder=sda,sdb --append="crashkernel=auto rhgb quiet"

#clear the mbr
zerombr
#clear out all partitions
clearpart --all --initlabel
url --url=http://192.168.10.10/image/cent-65-x86-64

part raid.008001 --size=40000 --ondisk=sda
part raid.008002 --grow --size=4000 --ondisk=sda

part raid.008017 --size=40000 --ondisk=sdb
part raid.008018 --grow --size=4000 --ondisk=sdb

raid / --fstype=ext4 --level=1 --device=md0 raid.008001 raid.008017
raid swap --level=1 --device=md1 raid.008002 raid.008018

#part / --size=8000 --ondisk=sda
#part swap --grow --size=1000 --ondisk=sda

#built in Intel raid adapter
#raid --level=container --device=md0 --useexisting --noformat raid.008000 raid.008016
#raid --level=1 --device=md127 --useexisting raid.009000
#part / --fstype=ext4 --size=100000
#part swap --size=4000

repo --name="CentOS"  --baseurl=http://192.168.10.10/image/cent-65-x86-64 --cost=100

reboot

%packages
@additional-devel
@core
@hardware-monitoring
@server-platform-devel
@server-policy
@workstation-policy
@postgresql-client
libgcrypt-devel
libXinerama-devel
libuuid-devel
xorg-x11-proto-devel
startup-notification-devel
libgnomeui-devel
libbonobo-devel
libXau-devel
libXrandr-devel
popt-devel
libxslt-devel
libglade2-devel
gnutls-devel
lm_sensors
%end


%post
#Set up bond0
sed -i 's/BOOTPROTO=\"dhcp\"/BOOTPROTO=\"static\"/' /etc/sysconfig/network-scripts/ifcfg-bond0
sed -i 's/HWADDR/#HWADDR/' /etc/sysconfig/network-scripts/ifcfg-bond0
echo 'BONDING_OPTS="mode=active-backup miimon=100 primary=eth0"' >> /etc/sysconfig/network-scripts/ifcfg-bond0
echo 'IPADDR="192.168.10.58"' >> /etc/sysconfig/network-scripts/ifcfg-bond0
echo 'NETMASK="255.255.255.0"' >> /etc/sysconfig/network-scripts/ifcfg-bond0
echo 'GATEWAY="192.168.10.1"' >> /etc/sysconfig/network-scripts/ifcfg-bond0

#set bond1 link delay
sed -i 's/HWADDR/#HWADDR/' /etc/sysconfig/network-scripts/ifcfg-eth2
sed -i 's/HWADDR/#HWADDR/' /etc/sysconfig/network-scripts/ifcfg-eth3
echo 'BONDING_OPTS="mode=balance-alb miimon=100 primary=eth2"' >> /etc/sysconfig/network-scripts/ifcfg-bond1
echo 'LINKDELAY=20' >> /etc/sysconfig/network-scripts/ifcfg-bond1

#fix permissions on home dir
chown -R transuser:transystem /home/transuser
chmod 760 /home/transuser

mv /etc/mdadm.conf /etc/mdadm.orig

#save the md conf
mdadm --detail --scan >> /etc/mdadm.conf

wget -P /root http://192.168.10.10/rhat_ic/cn_files/version25/cn-setup-doug.sh
chmod 777 cn-setup-doug.sh
%end
